{% extends "base.html" %}

{% load static %}

{% block title %}{{ video.video_title }}{% endblock %}

{% block content %}
<div id="primary">
    <div id="primary-content">
    <div style="max-width: 850px; margin: 0 auto;">
        {% if video.pk == 5 and "lofi hip hop mix" in video.video_title.lower %}
            <video controls width="850" autoplay>
            <source src="{% url 'lofi-radio' %}" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        {% else %}
        <video controls width="850" autoplay>
            <source src="{% url 'serve-video' video.pk %}" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        {% endif %}
    </div>
    </div>
    <div id="middle-content">
        <h3 id="primary-title">{{  video.video_title  }}</h3>
        <div id="video-detail-part1">
            <div id="channel-detail">
                <div id="channel-info">
                    <img class="channel-detail-icon" src="{{ channel.icon.url }}" alt="channel icon">
                    <div class="name-sub">
                        <div class="channel-name-check">
                            <p class="channel-namee">{{ channel.name }}</p>
                            <svg class="verified" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" focusable="false" aria-hidden="true" style="pointer-events: none; display: inherit; width: 100%; height: 100%;"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zM9.8 17.3l-4.2-4.1L7 11.8l2.8 2.7L17 7.4l1.4 1.4-8.6 8.5z"></path></svg>
                        </div>
                        <p class="sub-grey">{{ channel.subscribers }} subscribers</p>
                    </div>
                </div>
                {% if user.is_authenticated %}
                {% if subscribed %}
                    <form action="{% url 'unsubscribe' channel.handle video.pk %}" method="POST">
                        {% csrf_token %}
                        <button class="subscribee" id="unsubscribe" type="submit">Unsubscribe</button>
                    </form>
                {% else %}
                    <form action="{% url 'subscribe' channel.handle video.pk %}" method="POST">
                        {% csrf_token %}
                        <button class="subscribee" type="submit">Subscribe</button>
                    </form>
                {% endif %}
                    {% else %}
                    <a href="{% url 'login' %}"><button class="subscribee">Subscribe</button></a>
                {% endif %}
            </div>
            <div id="video-stats">
                <div id="like-dislike">
                    <div id="like-pack">
                        <form method="POST" action="{% url 'like-video' channel.handle video.id %}">
                        {% csrf_token %}
                        <button id="like" type="submit">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" focusable="false" aria-hidden="true" style="pointer-events: none; display: inherit; width: 100%; height: 100%;"><path fill="rgb(241 241 241)" fill-opacity="1" d=" M8,11 C8,11 3,11 3,11 C3,11 3,21 3,21 C3,21 8,21 8,21 C8,21 8,11 8,11z M18.770000457763672,11 C18.770000457763672,11 14.539999961853027,11 14.539999961853027,11 C14.539999961853027,11 16.059999465942383,6.059999942779541 16.059999465942383,6.059999942779541 C16.3799991607666,5.03000020980835 15.539999961853027,4 14.380000114440918,4 C13.800000190734863,4 13.239999771118164,4.239999771118164 12.859999656677246,4.650000095367432 C12.859999656677246,4.650000095367432 7,11 7,11 C7,11 7,21 7,21 C7,21 17.43000030517578,21 17.43000030517578,21 C18.489999771118164,21 19.40999984741211,20.329999923706055 19.6200008392334,19.389999389648438 C19.6200008392334,19.389999389648438 20.959999084472656,13.390000343322754 20.959999084472656,13.390000343322754 C21.229999542236328,12.149999618530273 20.18000030517578,11 18.770000457763672,11z M7,20 C7,20 4,20 4,20 C4,20 4,12 4,12 C4,12 7,12 7,12 C7,12 7,20 7,20z M19.979999542236328,13.170000076293945 C19.979999542236328,13.170000076293945 18.639999389648438,19.170000076293945 18.639999389648438,19.170000076293945 C18.540000915527344,19.649999618530273 18.030000686645508,20 17.43000030517578,20 C17.43000030517578,20 8,20 8,20 C8,20 8,11.390000343322754 8,11.390000343322754 C8,11.390000343322754 13.600000381469727,5.329999923706055 13.600000381469727,5.329999923706055 C13.789999961853027,5.119999885559082 14.079999923706055,5 14.380000114440918,5 C14.640000343322754,5 14.880000114440918,5.110000133514404 15.010000228881836,5.300000190734863 C15.079999923706055,5.400000095367432 15.15999984741211,5.559999942779541 15.100000381469727,5.769999980926514 C15.100000381469727,5.769999980926514 13.579999923706055,10.710000038146973 13.579999923706055,10.710000038146973 C13.579999923706055,10.710000038146973 13.180000305175781,12 13.180000305175781,12 C13.180000305175781,12 14.529999732971191,12 14.529999732971191,12 C14.529999732971191,12 18.760000228881836,12 18.760000228881836,12 C19.170000076293945,12 19.559999465942383,12.170000076293945 19.790000915527344,12.460000038146973 C19.920000076293945,12.609999656677246 20.049999237060547,12.859999656677246 19.979999542236328,13.170000076293945z"></path></svg>
                        </button>
                    </form>
                    <p>{{ video.likes }}</p>
                    </div>
                    <button id="dislike">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" focusable="false" aria-hidden="true" style="pointer-events: none; display: inherit; width: 100%; height: 100%;"><path fill="rgb(241 241 241)" d="M17 4H6.57c-1.07 0-1.98.67-2.19 1.61l-1.34 6C2.77 12.85 3.82 14 5.23 14h4.23l-1.52 4.94C7.62 19.97 8.46 21 9.62 21c.58 0 1.14-.24 1.52-.65L17 14h4V4h-4zm-6.6 15.67c-.19.21-.48.33-.78.33-.26 0-.5-.11-.63-.3-.07-.1-.15-.26-.09-.47l1.52-4.94.4-1.29H5.23c-.41 0-.8-.17-1.03-.46-.12-.15-.25-.4-.18-.72l1.34-6c.1-.47.61-.82 1.21-.82H16v8.61l-5.6 6.06zM20 13h-3V5h3v8z"></path></svg>
                    </button>
                </div>
                <button id="share">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" focusable="false" aria-hidden="true" style="pointer-events: none; display: inherit; width: 100%; height: 100%;"><path d="M15 5.63 20.66 12 15 18.37V14h-1c-3.96 0-7.14 1-9.75 3.09 1.84-4.07 5.11-6.4 9.89-7.1l.86-.13V5.63M14 3v6C6.22 10.13 3.11 15.33 2 21c2.78-3.97 6.44-6 12-6v6l8-9-8-9z"></path></svg>
                    Share
                </button>
                <button id="clip">
                    <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24" focusable="false" aria-hidden="true" style="pointer-events: none; display: inherit; width: 100%; height: 100%;"><path d="M8 7c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1zm-1 9c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm3.79-7.77L21 18.44V20h-3.27l-5.76-5.76-1.27 1.27c.19.46.3.96.3 1.49 0 2.21-1.79 4-4 4s-4-1.79-4-4 1.79-4 4-4c.42 0 .81.08 1.19.2l1.37-1.37-1.11-1.11C8 10.89 7.51 11 7 11c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4c0 .43-.09.84-.21 1.23zm-.71.71-.43-.44.19-.58c.11-.34.16-.64.16-.92 0-1.65-1.35-3-3-3S4 5.35 4 7s1.35 3 3 3c.36 0 .73-.07 1.09-.21l.61-.24.46.46 1.11 1.11.71.71-.71.71-1.37 1.37-.43.43-.58-.18C7.55 14.05 7.27 14 7 14c-1.65 0-3 1.35-3 3s1.35 3 3 3 3-1.35 3-3c0-.38-.07-.75-.22-1.12l-.25-.61.47-.47 1.27-1.27.71-.71.71.71L18.15 19H20v-.15l-9.92-9.91zM17.73 4H21v1.56l-5.52 5.52-2.41-2.41L17.73 4zm.42 1-3.67 3.67 1 1L20 5.15V5h-1.85z"></path></svg>
                    Clip
                </button>
                <button>
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" focusable="false" aria-hidden="true" style="pointer-events: none; display: inherit; width: 100%; height: 100%;"><path d="M7.5 12c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5.67-1.5 1.5-1.5 1.5.67 1.5 1.5zm4.5-1.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm6 0c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z"></path></svg>
                </button>
            </div>
        </div>
        <div id="video-detail-part2">
            <div id="viewcounts-date">
                <p>{{ video.views }} views&nbsp;&nbsp;</p>
                <p>Streamed live {{ time_after_upload }}</p>
            </div>
            <pre>{{ video.video_description }}</pre>
            <div id="transcript">
                <h2>Transcript</h2>
                <br>
                <p>Follow along using the transcript.</p>
                <br>
                <button>
                    Show transcript
                </button>
            </div>
            <a id="part2-channel-link" href="{% url 'channel-detail' channel.handle %}"><div id="part2-channel">
                 <img class="channel-detail-icon" src="{{ channel.icon.url }}" alt="channel icon">
                 <div class="name-sub">
                     <div class="channel-name-check">
                         <p class="channel-namee">{{ channel.name }}</p>
                         <svg class="verified" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" focusable="false" aria-hidden="true" style="pointer-events: none; display: inherit; width: 100%; height: 100%;"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zM9.8 17.3l-4.2-4.1L7 11.8l2.8 2.7L17 7.4l1.4 1.4-8.6 8.5z"></path></svg>
                     </div>
                     <p class="sub-grey">{{ channel.subscribers }} subscribers</p>
                 </div>
            </div></a>
            <div id="bottom-menu">
                <button>
                    <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24" focusable="false" aria-hidden="true" style="pointer-events: none; display: inherit; width: 100%; height: 100%;"><path d="m10 8 6 4-6 4V8zm11-5v18H3V3h18zm-1 1H4v16h16V4z"></path></svg>
                    Videos
                </button>
                <button>
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" focusable="false" aria-hidden="true" style="pointer-events: none; display: inherit; width: 100%; height: 100%;"><path d="M4 20h14v1H3V6h1v14zM6 3v15h15V3H6zm2.02 14c.36-2.13 1.93-4.1 5.48-4.1s5.12 1.97 5.48 4.1H8.02zM11 8.5a2.5 2.5 0 015 0 2.5 2.5 0 01-5 0zm3.21 3.43A3.507 3.507 0 0017 8.5C17 6.57 15.43 5 13.5 5S10 6.57 10 8.5c0 1.69 1.2 3.1 2.79 3.43-3.48.26-5.4 2.42-5.78 5.07H7V4h13v13h-.01c-.38-2.65-2.31-4.81-5.78-5.07z"></path></svg>
                    About
                </button>
            </div>
        </div>
        <div id="video-detail-part3">
            <!-- COMMENT SECTION -->
            <div id="comment-section-head">
                <div id="comment-section-head-part1">
                    <h2>{{ video.comment_set.count }} Comment(s)</h2>
                <button id="sort-by">
                    <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24" focusable="false" aria-hidden="true" style="pointer-events: none; display: inherit; width: 100%; height: 100%;"><path d="M21 6H3V5h18v1zm-6 5H3v1h12v-1zm-6 6H3v1h6v-1z"></path></svg>
                    Sort by
                </button>
                </div>
                <div id="comment-section-head-part2">
                    <img class="channel-detail-icon" src="{{ user.user_icon.url }}" alt="user icon">
                    <form method="POST" action="">
                        {% csrf_token %}
                        {{ form.as_div }}
                        <button type="submit">Comment</button>
                    </form>
                </div>
                <div id="comment-section-list">
                    {% for comment in video.comment_set.all %}
                        <div class="comment">
                            <img class="channel-detail-icon" src="{{ comment.author.user_icon.url }}" alt="user icon">
                            <div class="comment-content">
                                <div class="comment-head">
                                    <p>@{{ comment.author.username }}&nbsp</p>
                                    <p class="comment-head-date">Posted on {{ comment.post_date.year }}/{{ comment.post_date.month }}/{{ comment.post_date.day }}</p>
                                </div>
                                <pre class="comment-body">{{ comment.comment }}</pre>
                                <div class="comment-footer">
                                    <form method="post" action="{% url 'like-comment' channel.handle video.id comment.id %}">
                                        {% csrf_token %}
                                        <button type="submit">
                                            <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24" focusable="false" aria-hidden="true" style="pointer-events: none; display: inherit; width: 100%; height: 100%;"><path d="M18.77 11h-4.23l1.52-4.94C16.38 5.03 15.54 4 14.38 4c-.58 0-1.14.24-1.52.65L7 11H3v10h14.43c1.06 0 1.98-.67 2.19-1.61l1.34-6c.27-1.24-.78-2.39-2.19-2.39zM7 20H4v-8h3v8zm12.98-6.83-1.34 6c-.1.48-.61.83-1.21.83H8v-8.61l5.6-6.06c.19-.21.48-.33.78-.33.26 0 .5.11.63.3.07.1.15.26.09.47l-1.52 4.94-.4 1.29h5.58c.41 0 .8.17 1.03.46.13.15.26.4.19.71z"></path></svg>
                                        </button>
                                        {{ comment.likes }}
                                    </form>
                                    <button class="down-vote">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" focusable="false" aria-hidden="true" style="pointer-events: none; display: inherit; width: 100%; height: 100%;"><path d="M17 4H6.57c-1.07 0-1.98.67-2.19 1.61l-1.34 6C2.77 12.85 3.82 14 5.23 14h4.23l-1.52 4.94C7.62 19.97 8.46 21 9.62 21c.58 0 1.14-.24 1.52-.65L17 14h4V4h-4zm-6.6 15.67c-.19.21-.48.33-.78.33-.26 0-.5-.11-.63-.3-.07-.1-.15-.26-.09-.47l1.52-4.94.4-1.29H5.23c-.41 0-.8-.17-1.03-.46-.12-.15-.25-.4-.18-.72l1.34-6c.1-.47.61-.82 1.21-.82H16v8.61l-5.6 6.06zM20 13h-3V5h3v8z"></path></svg>
                                    </button>
                                    <button class="reply-button">
                                        Reply
                                    </button>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
    <div id="secondary">
    {% for vid in suggestions %}
        <a href="{% url 'video-detail' vid.channel.handle vid.id %}">
                <div class="video-container">
                <img src="{{ vid.thumbnail.url }}" alt="Video Thumbnail">
                <div class="video-details">
                    <div class="second-row">
                    <p class="video-title">{{ vid.video_title }}</p>
                        <div class="video-dot-menu">
                            <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24" focusable="false" aria-hidden="true" style="pointer-events: none; display: inherit; width: 100%; height: 100%;"><path d="M12 16.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5-1.5-.67-1.5-1.5.67-1.5 1.5-1.5zM10.5 12c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5-.67-1.5-1.5-1.5-1.5.67-1.5 1.5zm0-6c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5-.67-1.5-1.5-1.5-1.5.67-1.5 1.5z"></path></svg>
                        </div>
                    </div>
                    <div class="second-row2">
                        <p class="video-channel">{{ vid.channel.handle }}</p>
                    </div>
                    <div class="third-row">
                    <p class="video-views">{{ vid.views }}K views</p>
                    <p>&nbsp;â€¢&nbsp;</p>
                    <p class="video-date"> Streamed on {{ vid.upload_date.year }}/{{ vid.upload_date.month }}/{{ vid.upload_date.day }}</p>
                    </div>
                </div>
            </div>
        </a>
    {% endfor %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<video id="lofi" autoplay muted></video>
<script>
  const video = document.getElementById('lofi');
  if (Hls.isSupported()) {
      const hls = new Hls();
      hls.loadSource("{% url 'lofi-radio' %}");
      hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
  } else {
      video.src = "{% url 'lofi-radio' %}";
  }
</script>

{% endblock %}